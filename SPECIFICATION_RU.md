# Спецификация проекта: IBKR Tax Assistant (Польша/PIT-38)

### Роль
Действуй как Старший Python-разработчик.

### Цель
Создать приложение для расчета налогов (PIT-38) на основе отчетов Interactive Brokers.

### Ключевой функционал

1.  **Входные данные:**
    * Сканирование папки `data/` на наличие CSV.
    * Фильтрация технических транзакций (переводы между счетами, ACATS).
    * Поддержка `manual_history.csv` для ввода исторических покупок.

2.  **Парсинг:**
    * Извлечение Сделок, Дивидендов, Налогов и **Корпоративных Действий**.
    * **Сплиты:** Обработка дробления акций (Split) без создания налогового события.
    * **Сток-дивиденды:** Учет бонусных акций как покупки с ценой 0.

3.  **Финансовая логика:**
    * **FIFO:** Строгое сопоставление партий.
    * **Курсы NBP:** Правило D-1, рекурсия на праздники, пакетная загрузка (Bulk Cache).
    * **Безопасность:** Использование SHA256 для дедупликации.

4.  **Отчетность (PDF):**
    * **Структура:**
        1.  Титульный лист.
        2.  Портфель на конец года.
        3.  История сделок.
        4.  **Журнал Корпоративных Действий** (Сплиты, Спин-оффы).
        5.  Сводка дивидендов (по месяцам).
        6.  **Детализация дивидендов** (Полный список выплат с курсами).
        7.  Годовая сводка и диагностика.
        8.  **Помощник PIT-38** (Готовые цифры для декларации).

5.  **QA и CI/CD:**
    * Юнит-тесты (`pytest`).
    * Линтинг (`flake8`) и сканирование уязвимостей (`bandit`) через GitHub Actions.